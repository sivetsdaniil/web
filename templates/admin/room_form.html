{% extends "base.html" %}

{% if room %}
    {% set page_title = "Редактировать номер " ~ room.number %}
{% else %}
    {% set page_title = "Создать номер" %}
{% endif %}

{% block title %}Админка — {{ page_title }}{% endblock %}

{% block content %}
<h1 class="mb-4">{{ page_title }}</h1>

<form method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label for="number" class="form-label">Номер</label>
        <input type="text" class="form-control" id="number" name="number"
               value="{{ room.number if room else '' }}" required>
    </div>
    <div class="mb-3">
        <label for="room_type" class="form-label">Тип номера</label>
        <input type="text" class="form-control" id="room_type" name="room_type"
               value="{{ room.room_type if room else '' }}" required>
    </div>
    <div class="mb-3">
        <label for="price_per_night" class="form-label">Цена за ночь, ₽</label>
        <input type="number" step="0.01" min="0" class="form-control" id="price_per_night" name="price_per_night"
               value="{{ room.price_per_night if room else '' }}" required>
    </div>
    <div class="mb-3">
        <label for="capacity" class="form-label">Вместимость</label>
        <input type="number" min="1" class="form-control" id="capacity" name="capacity"
               value="{{ room.capacity if room else 1 }}" required>
    </div>
    <div class="mb-3">
        <label for="hotel_id" class="form-label">Отель</label>
        <select class="form-select" id="hotel_id" name="hotel_id" required>
            <option value="" disabled {% if not (room and room.hotel_id) %}selected{% endif %}>Выберите отель</option>
            {% for hotel in hotels %}
                <option value="{{ hotel.id }}" {% if room and room.hotel_id == hotel.id %}selected{% endif %}>
                    {{ hotel.name }}{% if hotel.city %} — {{ hotel.city }}{% endif %}
                </option>
            {% endfor %}
        </select>
        {% if not hotels %}
            <div class="form-text text-danger">Сначала создайте отель в базе.</div>
        {% endif %}
    </div>
    <div class="mb-3">
        <label for="description" class="form-label">Описание</label>
        <textarea class="form-control" id="description" name="description" rows="4">{{ room.description if room else '' }}</textarea>
    </div>
    <div class="mb-3">
        <label for="image" class="form-label">Фото номера (png, jpg, jpeg, webp)</label>
        <input type="file" class="form-control" id="image" name="image" accept=".png,.jpg,.jpeg,.webp">
        {% if room and room.image_filename %}
            <div class="mt-2">
                <div class="small text-muted mb-1">Текущее фото:</div>
                <img src="{{ url_for('static', filename='uploads/' ~ room.image_filename) }}" alt="Фото номера {{ room.number }}" class="img-fluid rounded" style="max-height: 200px;">
            </div>
            <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" value="on" id="remove_image" name="remove_image">
                <label class="form-check-label" for="remove_image">
                    Удалить фото
                </label>
            </div>
        {% endif %}
    </div>
    <button type="submit" class="btn btn-primary">Сохранить</button>
    <a href="{{ url_for('admin_rooms') }}" class="btn btn-secondary">Отмена</a>
{% endblock %}


